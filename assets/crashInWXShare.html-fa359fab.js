import{_ as n,p as s,q as a,a1 as t}from"./framework-5866ffd3.js";const p="/vuepress-summary/assets/wechatShareResolve-f0e42e58.png",e={},c=t(`<h1 id="微信分享安卓手机闪退" tabindex="-1"><a class="header-anchor" href="#微信分享安卓手机闪退" aria-hidden="true">#</a> 微信分享安卓手机闪退</h1><h2 id="描述" tabindex="-1"><a class="header-anchor" href="#描述" aria-hidden="true">#</a> 描述</h2><p>使用cordova-plugin-wechat插件，对于安卓手机，点击分享到微信，弹出“获取文件访问权限”，过一会闪退</p><h2 id="原因" tabindex="-1"><a class="header-anchor" href="#原因" aria-hidden="true">#</a> 原因</h2><p>报“文件访问权限被拒”的错，应该是弹出访问权限的同时，微信分享未停止，然后就因为没（来得及给）获取到文件访问权限闪退。</p><h2 id="解决" tabindex="-1"><a class="header-anchor" href="#解决" aria-hidden="true">#</a> 解决</h2><p>找到 项目/plugins/cordova-plugin-wechat/src/android/wechat.java文件中的share方法，添加一个判断：<br> 如果是图片分享，如果没有文件访问权限，就弹出访问获取权限弹框，同时return false（终止分享）<br> 理论上最好等 访问获取权限弹框 的结果，也就是用户同意的话继续分享，不同意则终止分享（用回调或等待的方式），但是我不会java，不知道怎么写，只好直接return了</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JSONObject</span> message <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span><span class="token constant">KEY_ARG_MESSAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token constant">KEY_ARG_MESSAGE_MEDIA</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JSONObject</span> media <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getJSONObject</span><span class="token punctuation">(</span><span class="token constant">KEY_ARG_MESSAGE_MEDIA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> type <span class="token operator">=</span> media<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token constant">KEY_ARG_MESSAGE_MEDIA_TYPE</span><span class="token punctuation">)</span> <span class="token operator">?</span> media
            <span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token constant">KEY_ARG_MESSAGE_MEDIA_TYPE</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">TYPE_WECHAT_SHARING_IMAGE</span><span class="token punctuation">;</span>
    <span class="token comment">// 分享图片，需要文件访问权限，否则闪退</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token constant">TYPE_WECHAT_SHARING_IMAGE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cordova<span class="token punctuation">.</span><span class="token function">hasPermission</span><span class="token punctuation">(</span><span class="token constant">ANDROID_WRITE_EXTERNAL_STORAGE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cordova<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_ENABLE_PERMISSION</span><span class="token punctuation">,</span> <span class="token constant">ANDROID_WRITE_EXTERNAL_STORAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+p+'" alt="微信分享闪退解决"></p>',9),o=[c];function i(l,u){return s(),a("div",null,o)}const k=n(e,[["render",i],["__file","crashInWXShare.html.vue"]]);export{k as default};
