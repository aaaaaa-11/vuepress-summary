import{_ as p,M as o,p as l,q as i,R as n,t as s,N as e,a1 as t}from"./framework-5866ffd3.js";const c={},r=n("h1",{id:"首屏加载慢、白屏",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#首屏加载慢、白屏","aria-hidden":"true"},"#"),s(" 首屏加载慢、白屏")],-1),u=n("p",null,"补充：vue+cordova打包，项目第一次打开很慢",-1),d=n("h2",{id:"解决",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#解决","aria-hidden":"true"},"#"),s(" 解决")],-1),v={href:"https://router.vuejs.org/zh/guide/advanced/lazy-loading.html",target:"_blank",rel:"noopener noreferrer"},k=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token comment">// vue2.x</span>
  <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* chunkName */</span> <span class="token string">&#39;./xxx.vue&#39;</span><span class="token punctuation">)</span>

  <span class="token comment">// vite.config.js</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// https://rollupjs.org/guide/en/#outputmanualchunks</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">manualChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&#39;group-user&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&#39;./src/views/UserDetail.vue&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;./src/views/User.vue&#39;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>图片懒加载<br> 方法一：自定义图片懒加载指令</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vue2，参考：https://v2.cn.vuejs.org/v2/guide/custom-directive.html</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">&#39;指令名称&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">bind</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> bind<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// vue3，参考：https://cn.vuejs.org/guide/reusability/custom-directives.html</span>
app<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">&#39;指令名称&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token string">&#39;钩子函数&#39;</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),m={href:"https://github.com/hilongjw/vue-lazyload",target:"_blank",rel:"noopener noreferrer"},b=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;./xxx.png&quot;</span> <span class="token operator">&gt;</span>
  <span class="token comment">// 改为</span>
  <span class="token operator">&lt;</span>img v<span class="token operator">-</span>lazy<span class="token operator">=</span><span class="token string">&quot;./xxx.png&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),g={start:"3"},h={href:"https://github.com/webpack-contrib/compression-webpack-plugin",target:"_blank",rel:"noopener noreferrer"},_=n("li",null,[n("p",null,"将一些访问时间久的文件放到本地")],-1),x=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token comment">// 假设xxx.js文件不是很大，但是访问需要10s</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;http://xxx.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token comment">// 改为</span>
  <span class="token comment">// 将xxx.js下载到本地，假设路径为./xxx.js</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./xxx.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>加loading效果</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token comment">// html</span>
  <span class="token comment">// 写一个加载中的遮罩，在加载页面时显示</span>
  <span class="token comment">// 使用一个全局的状态（可以在vuex中管理）来控制显隐，默认加载中</span>
  <span class="token operator">&lt;</span>Loading v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;loadingPage&quot;</span><span class="token operator">&gt;</span>loading<span class="token operator">&lt;</span><span class="token operator">/</span>Loading<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>router<span class="token operator">-</span>view v<span class="token operator">-</span>show<span class="token operator">=</span><span class="token string">&quot;!loadingPage&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>

  <span class="token comment">// router.js中监听路由离开则显示加载中，路由加载完成时隐藏加载效果</span>
  router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    loadingPage <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token comment">// ...</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    loadingPage <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li><p>依赖使用第三方cdn加载<br> 注意：引入cdn后，需要注释掉main.js中的引入<br> 问题：第三方cdn可能偶尔会失效（服务器崩了、停了、版本换了、。。。），或者访问的人多加载时间久，可以尝试用4.的方式将cdn下载到本地</p></li><li><p>不生成map文件 代码打包后会压缩和加密，如果运行出错了，可能看不出来哪里报错，map文件会存储代码转换前后对应位置，可以用来定位报错。</p></li><li><p>去掉不必要的console.log和debugger</p></li><li><p>一些UI组件按需导入</p></li><li><p>打包分析<br> 分析打包后的文件结构</p></li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// packae.json
// 在build后面加--report
&quot;scripts&quot;: {
  &quot;build&quot;: &quot;vue-cli-service build --report&quot;,
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),f={href:"https://www.npmjs.com/package/rollup-plugin-visualizer",target:"_blank",rel:"noopener noreferrer"},j=n("br",null,null,-1),q=n("br",null,null,-1),y=n("ol",{start:"11"},[n("li",null,[n("p",null,"封装组件，代码优化")]),n("li",null,[n("p",null,"SSR")]),n("li",null,[n("p",null,"骨架屏（优化体验）")])],-1);function w(z,N){const a=o("ExternalLinkIcon");return l(),i("div",null,[r,u,d,n("ol",null,[n("li",null,[n("a",v,[s("路由懒加载"),e(a)])])]),k,n("p",null,[s("方法二："),n("a",m,[s("使用已有的插件"),e(a)])]),b,n("ol",g,[n("li",null,[n("p",null,[s("webpack开启"),n("a",h,[s("Gzip压缩"),e(a)])])]),_]),x,n("p",null,[s("vite打包分析插件"),n("a",f,[s("rollup-plugin-visualizer"),e(a)]),j,s(" 一些静态资源能否替换，例如将大图片换成小图片"),q,s(" 一些依赖过大，是否能换成其他依赖，例如把moment.js换成day.js")]),y])}const V=p(c,[["render",w],["__file","loadingOptimization.html.vue"]]);export{V as default};
